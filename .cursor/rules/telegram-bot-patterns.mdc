---
globs: src/bot/**/*.ts
description: "Паттерны для Telegram бота"
---

# Паттерны Telegram бота

## Структура команд:
- Каждая команда должна быть в отдельном файле в папке commands/
- Экспортируйте функции команд для регистрации в основном файле бота
- Используйте типизированные контексты Telegraf

## Обработка состояний:
- Используйте Map для хранения состояний пользователей
- Определяйте enum для этапов обработки
- Пример из проекта:
```typescript
const userStates = new Map<number, UserState>();
```

## Обработка документов:
- Проверяйте тип файла перед обработкой
- Используйте Buffer для работы с файлами
- Валидируйте MIME типы

## Сообщения пользователю:
- Используйте статусные сообщения для длительных операций
- Обновляйте статус через editMessageText
- Отправляйте понятные сообщения об ошибках на русском языке

## Graceful shutdown:
- Регистрируйте обработчики SIGINT и SIGTERM
- Используйте bot.stop() для корректного завершения

## Обработка ошибок:
- Всегда оборачивайте операции в try-catch
- Логируйте ошибки для отладки
- Отправляйте пользователю понятные сообщения